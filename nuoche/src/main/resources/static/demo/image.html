<!DOCTYPE html>
<html>
<head>
    <title>Dynamic Image Loading with jQuery</title>
    <!-- 引入Bootstrap和jQuery -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <style>
        /* 自定义样式 */
        .small-image-container {
            position: relative; /* 相对定位，使得下方状态框可以相对于此位置定位 */
            cursor: pointer;
        }

        .small-image {
            max-width: 100%; /* 图片最大宽度为容器宽度 */
            height: auto; /* 保持宽高比 */
            margin-bottom: 10px; /* 图片间距 */
            transition: border 0.3s; /* 添加过渡效果 */
        }

        .image-status {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 5px;
            text-align: center;
            transition: background-color 0.3s; /* 添加过渡效果 */
        }

        .status-normal {
            background-color: #4CAF50; /* 绿色 */
            color: white;
        }

        .status-abnormal {
            background-color: #FF0000; /* 红色 */
            color: white;
        }

        .status-unknown {
            background-color: #808080; /* 灰色 */
            color: white;
        }

        .status-selected {
            background-color: #3498db; /* 蓝色，表示选中状态 */
            color: white;
        }

        .modal-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7); /* 半透明黑色背景 */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            max-width: 80%;
            max-height: 80%;
            object-fit: contain;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        /* 自定义每行的间距 */
        .custom-row-margin {
            margin-bottom: 20px;
        }

        /* 批量选中按钮样式 */
        #selectAllBtn {
            margin-bottom: 10px;
        }

        /* Checkbox 样式 */
        .checkbox-container {
            position: absolute;
            top: 5px;
            right: 5px;
        }

        .checkbox-container input {
            cursor: pointer;
        }
    </style>
</head>
<body>

<!-- 批量选中按钮 -->
<button class="btn btn-primary" id="selectAllBtn">批量选中</button>

<div class="container" id="image-gallery">
    <!-- 动态加载的图片将放在这里 -->
</div>

<!-- 放大显示的模态框 -->
<div class="modal-container" id="modalContainer">
    <span class="close-modal" onclick="closeModal()">&times;</span>
    <img class="modal-content" id="modalImage">
</div>

<script>
$(document).ready(function() {
    $.ajax({
        url: '/get-images',
        type: 'GET',
        dataType: 'json',
        success: function(data) {
            // 处理返回的图片URL数组
            for (var i = 0; i < data.length; i++) {
                // 创建列容器，每行显示6个图片
                if (i % 6 === 0) {
                    $('#image-gallery').append($('<div class="row custom-row-margin">'));
                }
                // 在当前行容器中添加图片列
                $('#image-gallery .row:last-child').append(
                    $('<div class="col-md-2">').append(
                        $('<div class="small-image-container">').append(
                            $('<img>').attr('src', data[i]).addClass('img-fluid small-image').click(function() {
                                openModal($(this).attr('src'));
                            }),
                            $('<div class="image-status status-normal">').text('状态: 正常'), // 初始状态为正常
                            $('<div class="checkbox-container">').append(
                                $('<input type="checkbox">').click(function(e) {
                                    e.stopPropagation(); // 防止点击 checkbox 触发父容器的 click 事件
                                })
                            )
                        )
                    )
                );
            }
        },
        error: function(error) {
            console.log('Error:', error);

            var data = ["1.png", "2.png", "1.png", "2.png", "1.png", "2.png", "1.png", "2.png"];


            for (var i = 0; i < data.length; i++) {
                // 创建列容器，每行显示6个图片
                if (i % 6 === 0) {
                    $('#image-gallery').append($('<div class="row custom-row-margin">'));
                }
                // 在当前行容器中添加图片列
                $('#image-gallery .row:last-child').append(
                    $('<div class="col-md-2">').append(
                        $('<div class="small-image-container">').append(
                            $('<img>').attr('src', data[i]).addClass('img-fluid small-image').click(function() {
                                openModal($(this).attr('src'));
                            }),
                            $('<div class="image-status status-normal">').text('状态: 正常'), // 初始状态为正常
                            $('<div class="checkbox-container">').append(
                                $('<input type="checkbox">').click(function(e) {
                                    e.stopPropagation(); // 防止点击 checkbox 触发父容器的 click 事件
                                })
                            )
                        )
                    )
                );
            }
        }
    });
});

// 批量选中按钮点击事件
$('#selectAllBtn').click(function() {
    // 切换所有状态框的选中状态
    $('.image-status').toggleClass('status-selected');
    // 切换所有图片的边框
    $('.small-image').toggleClass('selected-border');
    // 切换所有 checkbox 的选中状态
    $('input[type="checkbox"]').prop('checked', function(i, value) {
        return !value;
    });
});

function openModal(src) {
    $('#modalImage').attr('src', src);
    $('#modalContainer').css('display', 'flex');
}

function closeModal() {
    $('#modalContainer').css('display', 'none');
}
</script>

</body>
</html>
